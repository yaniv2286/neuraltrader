# ============================================================
# VT SWEET SPOT RULESET (PDF-BASED) — BASELINE v1
# ============================================================
# Purpose:
# - Encode the PDF-derived entry/exit logic as formal YAML.
# - Keep baseline immutable.
# - Allow parallel experimental variants via config overrides.
#
# Source PDFs:
# - "Guide to Becoming a Master Trader – Power of Volume & Trend"
#   (Sweet Spot: buy when red/yellow in sweet spot; sell when drop below 80; volume+trend edge)
# - "Trading Checklist" (confirms Sweet Spot check + additional discretionary checklist vetoes)
# - "Chart Setup Instructions" (SMA 25/50/100/200; Daily Stoch 10,3,3; Weekly Stoch 19,4,4; colors red/yellow)
#
# Non-negotiable:
# - Baseline strategy VT_SweetSpot_v1 MUST NOT change.
# - New strategies run in parallel using overrides only (no code duplication, no baseline branching).
# ============================================================

version: 1

# ============================================================
# STRATEGY METADATA
# ============================================================
strategy:
  id: "VT_SweetSpot_v1"
  name: "VT Sweet Spot - Baseline"
  description: "Canonical Sweet Spot strategy - momentum confirmation with dual stochastic validation"
  version: "1.0.0"
  immutable: true  # CANNOT be modified - variants must inherit and override
  author: "PDF-derived ruleset"
  created: "2026-01-30"

# ============================================================
# GLOBAL SETTINGS
# ============================================================
globals:
  execution:
    timeframe: "1D"
    signal_time: "after_close"       # decisions made using Day T close
    execution_time: "next_day_open"  # execute on Day T+1 open
    enforce_one_bar_delay: true
    allow_shorts: false               # LONG ONLY (v1)

  data:
    provider: "tiingo"
    price_type: "adjusted"
    use_all_available_history: true
    cache_policy:
      use_cache: true
      fetch_only_missing: true

  cost_model:
    commission_per_trade: 1.00      # $1 per trade
    slippage_bps: 5                 # 0.05% slippage
    spread_bps: 10                  # 0.10% spread

  outputs:
    excel:
      one_file_per_run: true
      format: "trading_backtest_excel"  # Use Trading Backtest Excel format
      sheets:
        - "How_To_Read"
        - "100K_Reality_Check"
        - "Equity_Curve"
        - "Trade_Stats"
        - "ALL_TRADES"
        - "PER_STOCK_SUMMARY"
        - "STRATEGY_COMPARISON"

# ============================================================
# CANONICAL SWEET SPOT DEFINITION (IMMUTABLE)
# ============================================================
# A market condition where:
# 1. Price is in a confirmed uptrend (above all major SMAs: 25, 50, 100, 200)
# 2. Volume confirms participation (≥ 30-day average)
# 3. Both daily and weekly stochastic momentum are above 80
#    - Indicating sustained institutional buying pressure
#
# This is NOT a parameter to optimize.
# This is the REFERENCE REGIME.
# ============================================================

sweet_spot:
  definition: |
    A market condition where price is in a confirmed uptrend (above all major SMAs),
    volume confirms participation (≥ 30-day average), and both daily and weekly
    stochastic momentum are above 80 — indicating sustained institutional buying pressure.
  
  philosophy:
    - "Confirmation, not prediction"
    - "Momentum must already be present"
    - "Quality over quantity - many days no trade"
    - "Stand aside when conditions aren't perfect"
  
  not_a_sweet_spot:
    - "NOT oversold bounce"
    - "NOT stochastic crossing up from 20"
    - "NOT bottom fishing"
    - "NOT divergence trading"
    - "NOT prediction"

# ============================================================
# ENTRY RULES (ALL MUST BE TRUE)
# ============================================================
entry_rules:
  # Rule 1: Power Stock (NO PARTIAL CREDIT)
  power_stock:
    enabled: true
    description: "Price must be above ALL major SMAs - no partial credit"
    sma_periods: [25, 50, 100, 200]
    condition: "price_above_all_smas"
    strict: true  # If price below ANY SMA → reject immediately
    
  # Rule 2: Volume Fuel (MANDATORY)
  volume:
    enabled: true
    description: "Volume confirms institutional participation"
    min_vs_avg: 1.0  # volume >= 30-day average
    avg_period: 30
    quote: "If I'm not getting fuel, I'm not going to trade"
    
  # Rule 3: Weekly Stochastic Sweet Spot
  weekly_stochastic:
    enabled: true
    description: "Weekly stochastic defines primary trend"
    parameters:
      k_period: 19
      d_period: 4
      smooth: 4
    sweet_spot:
      k_min: 80  # %K >= 80 (red line)
      d_min: 80  # %D >= 80 (yellow line)
      both_required: true  # BOTH must be >= 80
    calculation: "weekly_bars"  # Resample daily to weekly
    
  # Rule 4: Daily Stochastic Sweet Spot
  daily_stochastic:
    enabled: true
    description: "Daily stochastic defines timing"
    parameters:
      k_period: 10
      d_period: 3
      smooth: 3
    sweet_spot:
      k_min: 80  # %K >= 80 (red line)
      d_min: 80  # %D >= 80 (yellow line)
      both_required: true  # BOTH must be >= 80

# ============================================================
# EXIT RULES (ANY TRIGGERS EXIT)
# ============================================================
exit_rules:
  # Exit 1: Daily Stochastic Exits Sweet Spot
  daily_stochastic_exit:
    enabled: true
    description: "Exit when daily stochastic drops below 80"
    trigger: "daily_k_below_80_or_d_below_80"
    k_threshold: 80
    d_threshold: 80
    logic: "OR"  # Exit if EITHER %K OR %D drops below 80
    note: "Daily is the timing trigger - weekly losing 80 happens later"
    
  # Exit 2: Trailing Stop
  trailing_stop:
    enabled: true
    description: "Protect profits with trailing stop"
    initial_stop_pct: 0.03  # 3% from entry
    trail_pct: 0.03         # Trail 3% from peak
    move_to_breakeven: false  # Simple trailing, no breakeven logic

# ============================================================
# POSITION SIZING
# ============================================================
position_sizing:
  method: "fixed_percentage"
  base_size_pct: 0.10  # 10% of capital per position
  max_size_pct: 0.10
  max_positions: 10
  max_ticker_exposure_pct: 0.20  # Max 20% in any single ticker

# ============================================================
# RISK MANAGEMENT
# ============================================================
risk_management:
  max_drawdown_pct: 0.20  # Max 20% drawdown
  daily_loss_limit_pct: 0.03  # Max 3% loss per day
  max_consecutive_losses: null  # No limit (let strategy play out)

# ============================================================
# INDICATORS (REQUIRED FOR STRATEGY)
# ============================================================
indicators:
  sma:
    - period: 25
    - period: 50
    - period: 100
    - period: 200
  
  volume:
    - type: "simple_moving_average"
      period: 30
  
  stochastic_daily:
    k_period: 10
    d_period: 3
    smooth: 3
    
  stochastic_weekly:
    k_period: 19
    d_period: 4
    smooth: 4
    resample: "weekly"  # Resample daily bars to weekly

# ============================================================
# ACCEPTANCE CRITERIA (FOR EXPERIMENTAL VARIANTS)
# ============================================================
acceptance_criteria:
  description: "New strategies must beat baseline on these metrics"
  
  required:
    cagr_min_pct: null  # Must be >= baseline CAGR
    max_drawdown_max_pct: null  # Must be <= baseline max DD (less negative)
    
  preferred:
    profit_factor_min: 1.5
    win_rate_min_pct: 55
    
  reject_if:
    - "cagr < baseline_cagr"
    - "max_drawdown < baseline_max_drawdown"  # More negative = worse
    - "total_trades > baseline_trades * 2"  # No overtrading

# ============================================================
# BACKTEST SETTINGS
# ============================================================
backtest:
  initial_capital: 100000
  start_date: null  # Use all available data
  end_date: null    # Use all available data
  
  universe:
    tickers: "all_available"  # Use all 154 tickers
    
  validation:
    train_test_split: null  # No split for baseline (use all data)
    walk_forward: false     # Baseline uses all data
    
# ============================================================
# NOTES
# ============================================================
notes:
  selectivity: |
    This strategy is VERY selective by design:
    - Power Stock filters ~70% of stocks
    - Volume filters ~50%
    - Weekly Stoch (both ≥80) filters ~90%
    - Daily Stoch (both ≥80) filters ~90%
    Combined: Only 0.5-1% of stocks qualify at any time
    
  expected_performance: |
    Expected trades: 15-25 per year (very selective)
    Expected win rate: 70-80% (high quality setups)
    Expected CAGR: 15-25% (realistic for elite momentum)
    Expected max DD: -10-15% (strong momentum = less volatility)
    
  philosophy_summary: |
    "Many days → no trade"
    "Low volume days → stand aside"
    "Choppy SMAs → stand aside"
    "Works less often, but more reliably"
    
  quote: |
    "I sell when my red and yellow lines drop below 80% and move out of the Sweet Spot."
    - Guide to Becoming a Master Trader
